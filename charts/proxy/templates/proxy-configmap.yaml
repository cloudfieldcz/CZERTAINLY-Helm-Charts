apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "proxy.fullname" . }}-configmap
  labels:
    {{- include "proxy.labels" . | nindent 4 }}
data:
  # Application settings
  PROXY_APPLICATION_NAME: {{ .Values.application.name | quote }}
  PROXY_APPLICATION_ENVIRONMENT: {{ .Values.application.environment | quote }}
  PROXY_APPLICATION_MAX_WORKERS: {{ .Values.application.maxWorkers | quote }}

  # AMQP settings
  PROXY_AMQP_BROKER_TYPE: {{ .Values.amqp.brokerType | quote }}
  {{- if .Values.amqp.url }}
  PROXY_AMQP_URL: {{ .Values.amqp.url | quote }}
  {{- end }}
  {{- if .Values.amqp.host }}
  PROXY_AMQP_HOST: {{ .Values.amqp.host | quote }}
  {{- end }}
  PROXY_AMQP_PORT: {{ .Values.amqp.port | quote }}
  PROXY_AMQP_USE_TLS: {{ .Values.amqp.useTls | quote }}
  PROXY_AMQP_AUTH_METHOD: {{ .Values.amqp.authMethod | quote }}
  {{- if .Values.amqp.keyName }}
  PROXY_AMQP_KEY_NAME: {{ .Values.amqp.keyName | quote }}
  {{- end }}
  PROXY_AMQP_TOKEN_EXPIRY: {{ .Values.amqp.tokenExpiry | quote }}
  {{- if .Values.amqp.entraId.tenantId }}
  PROXY_AMQP_ENTRAID_TENANT_ID: {{ .Values.amqp.entraId.tenantId | quote }}
  {{- end }}
  {{- if .Values.amqp.entraId.clientId }}
  PROXY_AMQP_ENTRAID_CLIENT_ID: {{ .Values.amqp.entraId.clientId | quote }}
  {{- end }}
  {{- if .Values.amqp.topicName }}
  PROXY_AMQP_TOPIC_NAME: {{ .Values.amqp.topicName | quote }}
  {{- end }}
  {{- if .Values.amqp.subscription }}
  PROXY_AMQP_SUBSCRIPTION: {{ .Values.amqp.subscription | quote }}
  {{- end }}
  {{- if .Values.amqp.responseTopic }}
  PROXY_AMQP_RESPONSE_TOPIC: {{ .Values.amqp.responseTopic | quote }}
  {{- end }}
  PROXY_AMQP_PREFETCH_COUNT: {{ .Values.amqp.prefetchCount | quote }}
  PROXY_AMQP_MESSAGE_LOCK_TIME: {{ .Values.amqp.messageLockTime | quote }}
  PROXY_AMQP_RECONNECT_INITIAL_DELAY: {{ .Values.amqp.reconnect.initialDelay | quote }}
  PROXY_AMQP_RECONNECT_MAX_DELAY: {{ .Values.amqp.reconnect.maxDelay | quote }}
  PROXY_AMQP_RECONNECT_FACTOR: {{ .Values.amqp.reconnect.factor | quote }}

  # HTTP client settings
  PROXY_HTTP_CLIENT_MAX_IDLE_CONNS: {{ .Values.httpClient.maxIdleConns | quote }}
  PROXY_HTTP_CLIENT_MAX_IDLE_CONNS_PER_HOST: {{ .Values.httpClient.maxIdleConnsPerHost | quote }}
  PROXY_HTTP_CLIENT_MAX_CONNS_PER_HOST: {{ .Values.httpClient.maxConnsPerHost | quote }}
  PROXY_HTTP_CLIENT_IDLE_CONN_TIMEOUT: {{ .Values.httpClient.idleConnTimeout | quote }}
  PROXY_HTTP_CLIENT_DIAL_TIMEOUT: {{ .Values.httpClient.dialTimeout | quote }}
  PROXY_HTTP_CLIENT_TLS_HANDSHAKE_TIMEOUT: {{ .Values.httpClient.tlsHandshakeTimeout | quote }}
  PROXY_HTTP_CLIENT_KEEP_ALIVE: {{ .Values.httpClient.keepAlive | quote }}
  PROXY_HTTP_CLIENT_DEFAULT_TIMEOUT: {{ .Values.httpClient.defaultTimeout | quote }}

  # HTTP server settings
  PROXY_HTTP_PORT: {{ .Values.http.port | quote }}
  PROXY_HTTP_READ_TIMEOUT: {{ .Values.http.readTimeout | quote }}
  PROXY_HTTP_WRITE_TIMEOUT: {{ .Values.http.writeTimeout | quote }}
  PROXY_HTTP_SHUTDOWN_TIMEOUT: {{ .Values.http.shutdownTimeout | quote }}

  # Metrics settings
  PROXY_METRICS_ENABLED: {{ .Values.metrics.enabled | quote }}
  PROXY_METRICS_PATH: {{ .Values.metrics.path | quote }}

  # Logging settings
  PROXY_LOGGING_LEVEL: {{ .Values.logging.level | quote }}
  PROXY_LOGGING_FORMAT: {{ .Values.logging.format | quote }}
