# Default values for proxy chart
# Azure Service Bus / RabbitMQ proxy

nameOverride: ""
fullnameOverride: ""
# Global parameters (for umbrella chart compatibility)
global:
  image:
    registry: ""
    repository: ""
    pullSecrets: []
  volumes:
    ephemeral:
      type: ""
      sizeLimit: ""
      storageClassName: ""
      custom: {}
  initContainers: []
  sidecarContainers: []
  additionalVolumes: []
  additionalVolumeMounts: []
  additionalPorts: []
  additionalEnv:
    variables: []
    configMaps: []
    secrets: []
# Replica count
replicaCount: 1
# Autoscaling configuration
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
# Service configuration
service:
  type: "ClusterIP"
  port: 8080
# Main container image
image:
  registry: ilmtestswcacr.azurecr.io
  repository: ""
  name: czertainly-proxy
  tag: "0.0.5"
  digest: ""
  pullPolicy: IfNotPresent
  pullSecrets: []
  command: []
  args: []
  securityContext:
    runAsNonRoot: true
    runAsUser: 65534
    runAsGroup: 65534
    readOnlyRootFilesystem: true
  probes:
    liveness:
      enabled: true
      custom: {}
      initialDelaySeconds: 10
      timeoutSeconds: 5
      periodSeconds: 30
      successThreshold: 1
      failureThreshold: 3
    readiness:
      enabled: true
      custom: {}
      initialDelaySeconds: 5
      timeoutSeconds: 5
      periodSeconds: 10
      successThreshold: 1
      failureThreshold: 3
    startup:
      enabled: true
      custom: {}
      initialDelaySeconds: 5
      timeoutSeconds: 5
      periodSeconds: 10
      successThreshold: 1
      failureThreshold: 30
  resources: {}
  # requests:
  #   cpu: 100m
  #   memory: 128Mi
  # limits:
  #   cpu: 500m
  #   memory: 256Mi
# Application configuration
application:
  name: "azure-sb-proxy"
  environment: "production"
  maxWorkers: 10
# Token-based configuration (alternative to individual settings)
# When set, the JWT token takes precedence over all other configuration
# Generate tokens using: token generate --from-config config.yaml
# See docs/TOKEN_CONFIG.md for format details
token: ""
# HMAC signing key for token signature verification (HS256/HS384/HS512)
# Leave empty for unsigned tokens (alg: none)
tokenSigningKey: ""
# AMQP / Message broker configuration
amqp:
  # Broker type: "azureservicebus" (default) or "rabbitmq"
  brokerType: "azureservicebus"
  # URL-based configuration (recommended)
  # Supports: amqp://, amqps://, wss:// (WebSocket)
  # Examples:
  #   WebSocket (firewall-friendly): wss://namespace.servicebus.windows.net
  #   AMQP over TLS:                 amqps://namespace.servicebus.windows.net:5671
  #   Plain AMQP:                    amqp://localhost:5672
  url: ""
  # Legacy host-based configuration (used if url is empty)
  host: ""
  port: 5671
  useTls: true
  # Authentication method: "sasl-plain" or "cbs" (Claims-Based Security)
  # - sasl-plain: Direct credential authentication (RabbitMQ, Azure Service Bus)
  # - cbs: Token-based authentication with automatic renewal (Azure Service Bus only)
  authMethod: "sasl-plain"
  # Credentials for SASL PLAIN or CBS with SAS tokens
  username: ""
  password: ""
  # CBS-specific settings (only used when authMethod is "cbs")
  # Token validity duration for SAS tokens (minimum: 2m)
  tokenExpiry: "1h"
  # Entra ID (Azure AD) configuration for CBS authentication
  # If entraId.clientId is set, Entra ID authentication is used instead of SAS tokens
  entraId:
    tenantId: ""
    clientId: ""
    clientSecret: ""
  # Topic and subscription configuration
  topicName: ""
  subscription: ""
  responseTopic: ""
  # AMQP tuning
  prefetchCount: 10
  messageLockTime: "300s"
  # Reconnection settings
  reconnect:
    initialDelay: "2s"
    maxDelay: "1m"
    factor: 2.0
# HTTP client settings (for connector calls)
httpClient:
  maxIdleConns: 100
  maxIdleConnsPerHost: 10
  maxConnsPerHost: 50
  idleConnTimeout: "90s"
  dialTimeout: "10s"
  tlsHandshakeTimeout: "10s"
  keepAlive: "30s"
  defaultTimeout: "30s"
# HTTP server settings
http:
  port: 8080
  readTimeout: "10s"
  writeTimeout: "10s"
  shutdownTimeout: "30s"
# Metrics configuration
metrics:
  enabled: true
  path: "/metrics"
# Logging configuration
logging:
  level: "info"
  format: "json"
# Local customizations
initContainers: []
sidecarContainers: []
additionalVolumes: []
additionalVolumeMounts: []
additionalPorts: []
additionalEnv:
  variables: []
  configMaps: []
  secrets: []
# Ephemeral volumes configuration
volumes:
  ephemeral:
    type: memory
    sizeLimit: "10Mi"
    storageClassName: ""
    custom: {}
# Service account configuration
serviceAccount:
  create: true
  annotations: {}
  name: ""
# Pod configuration
podLabels: {}
podAnnotations: {}
podSecurityContext: {}
# fsGroup: 65534

# Node selection
nodeSelector: {}
tolerations: []
affinity: {}
